---
Date: 2025-12-26
tags:
  - type/summary
  - topic/cloud
  - type/practice
aliases:
  - pod
  - job
  - cronjob
  - replicaset
  - parallelism
---
###### 이론
- [cloud-251223](../notes/cloud-251223.md)
###### 실습
- Pod 배포
	- 단일 Pod
	- 다중 Pod - 순차 실행
	- 다중 Pod - 병렬 실행
- Job
- CronJob
### 로그 출력용 단일 Pod
```sh
apiVersion: v1
kind: Pod
metadata:
  name: jde-hello-pod
  namespace: jde-ns
spec:
  template:
    spec:
      containers:
      - name: hello
        image: busybox:1.28
        command: ['sh', '-c', 'echo "Hello, Kubernetes!" && sleep 3600']
      restartPolicy: OnFailure

```
<img width="2342" height="543" alt="Pasted image 20251226110747" src="https://github.com/user-attachments/assets/fbd9a56b-f957-412a-b031-7bde48ae7426" />

### ReplicaSet
- 잘 안 씀
- ReplicaSet은 Pod 개수를 유지하는 컨트롤러
	- 실무에서는 Deployment를 통해 간접적으로 사용
	- Deployment는 ReplicaSet(Pod 개수) 관리와 함께 롤링 업데이트/롤백도 제공
```sh
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: jde-replicaset
  namespace: jde-ns
  labels:
    app: jde
spec:
  replicas: 3  # Pod 3개 유지 -> 하나를 삭제하거나 중단되면 즉시 새 Pod 생성
  selector:
    matchLabels:
      app: jde # ReplicaSet이 관리하는 Pod
  template: # ReplicaSet이 생성할 Pod
    metadata:
      labels:
        app: jde
    spec:
      containers:
      - name: nginx
        image: nginx:1.14.2
```
### 단일 Job
- Job: 일회성 작업 실행용 리소스
	- 작업 완료 후 즉시 종료(`Completed`)
```sh
apiVersion: batch/v1
kind: Job
metadata:
  name: jde-job
  namespace: jde-ns
spec:
  template:
    spec:
      containers:
      - name: secloudit-container
        image: busybox
        args: ["date"]  # 컨테이너 실행 시 현재 날짜 출력 후 종료
      restartPolicy: OnFailure
  backoffLimit: 2  # 최대 재시도 횟수, 2번 실패하면 Job은 실패
```
<img width="2201" height="908" alt="Pasted image 20251226113656" src="https://github.com/user-attachments/assets/5850f733-2e67-45cd-ab59-7ce289384ce5" />

- `Completed`: Job 정상 수행
### 다중 Job - 순차 실행
- `completions: 3`
	- 총 3개의 Pod가 성공으로 완료되어야 Job 종료
	- 기본적으로 순차 실행

```sh
apiVersion: batch/v1
kind: Job
metadata:
  name: jde-job
  namespace: jde-ns
spec:
  completions: 3  # 총 완료해야 할 Pod 개수
  template:
    metadata:
      labels:
        app: jde
    spec:
      restartPolicy: OnFailure
      containers:
      - name: secloudit-container
        image: busybox
        command: ["sleep", "30"]  # 30초 후 종료
```
<img width="1838" height="850" alt="Pasted image 20251226113415" src="https://github.com/user-attachments/assets/a5ac69c2-63c4-4cab-8ff7-8c3a920a0626" />

- Pod 3개가 순차적으로 실행 (2개는 Completed, 1개는 마지막 Running)
```sh
apiVersion: batch/v1
kind: Job
metadata:
  name: jde-job-c
  namespace: jde-ns
spec:
  completions: 3 # 총 완료해야 할 Pod 개수
  template:
    metadata:
      labels:
        app: jde
    spec:
      containers:
      - name: secloudit-container
        image: busybox
        args: ["sleep", "30"]
      restartPolicy: OnFailure
```
<img width="2614" height="523" alt="Pasted image 20251226114920" src="https://github.com/user-attachments/assets/24fc257d-fc31-4d00-9eb0-40e23e5c4253" />

- Pod 3개가 30초 간격으로 생성
### 다중 Job - Parallelism
```sh
apiVersion: batch/v1
kind: Job
metadata:
  name: jde-job-d
  namespace: jde-ns
spec:
  completions: 3  # 총 완료해야 할 Pod 개수
  parallelism: 3  # 동시에 실행할 Pod 최대 개수수
  template:
    metadata:
      labels:
        app: jde
    spec:
      containers:
      - name: secloudit-container
        image: quay.io/prometheus/busybox
        command: ["sleep", "30"]
      restartPolicy: OnFailure
```
<img width="2603" height="466" alt="Pasted image 20251226115311" src="https://github.com/user-attachments/assets/eb867119-4173-4a7c-96f8-b6666da5374e" />

- Pod 3개가 같은 시각에 생성
### CronJob
- CronJob
	- 정해진 시간마다 주기적으로 Job을 생성
```sh
apiVersion: batch/v1
kind: CronJob
metadata:
  name: jde-cronjob
  namespace: jde-ns
spec:
  schedule: "*/1 * * * *"  # 1분마다 실행행
  jobTemplate:  # CronJob이 매번 생성할 Job의 템플릿
    spec:
      template:
        spec:
          restartPolicy: Never
          containers:
          - name: jde-container
            image: kubetm/init
            command: ["sh", "-c", "echo 'start';sleep 20; echo 'end'"]
          terminationGracePeriodSeconds: 0
  successfulJobsHistoryLimit: 2  # 성공한 Job은 2개까지만 보관
  failedJobsHistoryLimit: 1  # 실패한 Job은 1개까지만 보관
```
<img width="2600" height="530" alt="Pasted image 20251226121137" src="https://github.com/user-attachments/assets/5446e57c-9da5-408b-a7ac-e141a4d31c57" />

- 1분마다 새로운 Job 생성 
- 시간이 지나면 오래된 Job 자동 삭제
