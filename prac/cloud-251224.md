---
Date: 2025-12-24
tags:
  - topic/cloud
  - type/practice
aliases:
  - pod
  - deployment
  - service
---
###### 실습 내용
1. Pod 배포
2. Deployment를 통한 Pod의 개수 유지와 자동 복구 확인
3. Service를 이용한 외부 트래픽 전달
### Pod: 단일 컨테이너
```sh
#Pod
apiVersion: v1
kind: Pod # 리소스 타입
metadata:
  name: jde-pod
  namespace: jde-ns # 리소스 격리 단위
spec:
  containers:
  - name: nginx # Pod 내부 컨테이너 이름
    image: nginx:1.14.2 # Docker Hub에서 가져올 컨테이너 이미지
    ports:
    - containerPort: 80 # 컨테이너 내부에서 사용하는 포트
```
- Pod
	- 쿠버네티스의 가장 기본적인 실행 단위
	- 컨트롤러가 없는 순수 실행 객체
### Deployment
```sh
#Deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: jde-deployment
  namespace: jde-ns
  labels:
    app: jde
spec:
  replicas: 3 # Pod의 개수 보장
  selector:
    matchLabels:
      app: jde # Deployment가 어떤 Pod를 관리할지 결정 -> 
			   # template.metadata.labels와 동일해야 함
  template: # Deployment가 새로 생성할 Pod 정보
    metadata:
      labels:
        app: jde
    spec:
      containers:
      - name: nginx
        image: nginx:1.14.2
        ports:
        - containerPort: 80
```
- Deployment
	- Pod 개수 보장(ReplicaSet)
	- Pod 장애/삭제 시 자동 재생성
### Service
```sh
#Service
apiVersion: v1
kind: Service
metadata:
  name: jde-service
  namespace: jde-ns
spec:
  type: NodePort
  selector:
    app: jde # Deployment의 label과 일치해야 트래픽 전달됨
  ports:
    - port: 80 # Service 내부 포트
      targetPort: 80  # Pod의 containerPort
      nodePort: 30007 # 외부 접속 포트: 모든 노드의 IP + 지정 포트로 접근 가능
```
- Service
	- Pod는 외부에서 직접 접근 불가하므로
	- Service가 네트워크 접근 지점 역할
### 로그 출력용 Pod
- 컨테이너 실행 시 command override 가능
```sh
#Pod
apiVersion: v1
kind: Pod
metadata:
  name: jde-hello-pod
  namespace: jde-ns
spec:
  template:    
    spec:
      containers:
      - name: hello
        image: busybox:1.28
        command: ['sh', '-c', 'echo "Hello, Kubernetes!" && sleep 3600']
        # Docker 이미지의 기본 cmd를 대체
      restartPolicy: OnFailure
```

### Multi-Container Pod
```sh
#Pod
apiVersion: v1
kind: Pod
metadata:
  name: jde-multi-pod
  namespace: jde-ns
spec:
  containers:
  - image: nginx
    name: container1
  - image: redis
    name: container2
  - image: consul:1.15
    name: container3
```
- 하나의 Pod 안에서 여러 컨테이너가 네트워크/스토리지 공유
	- 모든 컨테이너는 동일 IP 사용, localhost로 서로 통신 가능