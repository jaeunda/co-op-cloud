---
Date: 2025-12-29
tags:
  - type/practice
  - topic/cloud
aliases:
  - ssh
  - subnet
  - routing
  - ssh-key
  - nfs
  - install-kpaas
---
###### 실습
- [NHN CLoud - Network Firewall](https://docs.nhncloud.com/ko/Security/Network-Firewall/ko/overview/)
- [Github - K-Paas 컨테이너 플랫폼 설치 가이드](https://github.com/K-PaaS/container-platform/blob/master/install-guide/standalone/cp-cluster-install-single.md)
1. Key Pair 설정
2. Subnet/Routing
3. Instance 생성
4. Floating IP
5. SSH 접속
6. NFS 설치
7. SSH Key 배포
### Key Pair 설정
- Key Pair는 VM(Instance)에 SSH로 접속하기 위한 인증 수단
- `public-key` + `ssu-key.pem`
	- public key: 클라우드에 저장
	- private key: `ssu-key.pem` (사용자 PC에만 보관)
![[Pasted image 20251229110224.png]]
- 인스턴스 접속을 위한 보안 기반
### Subnet 생성
- Subnet 3개 생성 (`ssu1-subnet`, `ssu2-subnet`, `ssu3-subnet`)
![[Pasted image 20251229110451.png]]
![[Pasted image 20251229110703.png]]
##### 각 Subnet에 라우팅 테이블 연결 
- VPC 내부에서도 Subnet은 독립된 네트워크 영역이므로
- subnet 단독으로는 통신 불가 $\rightarrow$ 라우팅 테이블 연결
	- 외부와의 통신
	- 다른 Subnet과의 통신 가능
![[Pasted image 20251229110752.png]]
![[Pasted image 20251229110808.png]]
##### 라우팅 테이블 연결 확인
![[Pasted image 20251229110839.png]]
![[Pasted image 20251229110943.png]]
![[Pasted image 20251229111303.png]]
### Instant 5대 생성
- ![[Pasted image 20251229113424.png]]
- Control Plane (Master Node): `cluster1`
	- API Server, Scheduler, Controller Manager
- Storage Node(NFS): `cluster5`
	- NFS 기반 공유 스토리지
- Worker Node: `cluster2`, `cluster3`, `cluster4`
	- 실제 Pod 실행
![[Pasted image 20251229113156.png]]
##### Instant 생성
- Image: Ubuntu 22.04
- Instance Type: `r2.c2m8` (vCPU: 2,  RAM: 8GB)
- Instance 개수: 5개
- Root Block Storage: 50GB
- Key Pair: `ssu-key.pem`

![[Pasted image 20251229113533.png]]
- Kubernetes 아키텍처 구조를 실제 인스턴스 단위로 구현
### Floating IP 설정
- Floating IP ($\leftrightarrow$ Fixed IP)
	- Public IP의 역할: 외부에서 접속 가능한 IP
	- Architecture 관점에서는 SDN(Software Defined Networking) 환경에서 구현된 동적 1:1 NAT(Network Address Translation) 매핑
	- **Master Node가 다운된 경우(Hardware Failure)**
		- **매핑 정보를 새로운 Master Node의 Private IP로 변경하면, 사용자는 동일한 IP로 중단 없이 접속할 수 있음. (IP Remapping, Failover)**
-  Fixed IP (Private IP)
	- VM(Instance) 내부의 가상 네트워크 인터페이스에 실제로 할당됨.
![[Pasted image 20251229113704.png]]
![[Pasted image 20251229113715.png]]
- Master Node에 Floating IP 연결
- 외부 접속 지점과 내부 구조 분리
### MobaXterm을 이용한 인스턴스 접속
![[Pasted image 20251229114553.png]]
- 접속 정보:
	- Remote Host: Floating IP
	- Private Key: `ssu-key.pem`
![[Pasted image 20251229114612.png]]
- `cluster1`: Control Plane에 직접 접속
### NFS Storage 설치

![[Pasted image 20251229115857.png]]
![[Pasted image 20251229115908.png]]
- jde-cluster5 private IP로 접속
	- `sudo ssh ubuntu@192.168.1.9 -i ssu-key.pem`
![[Pasted image 20251229121426.png]]
##### `Cluster5`에 NFS Storage 설치
- NFS: 모든 노드가 공유하는 스토리지
	- Kubernetes에서 PV, PVC의 기반
![[Pasted image 20251229122510.png]]
- `sudo mkdir -p /home/share/nfs`
- `sudo chmod 777 /home/share/nfs`
- `/etc/exports`: 공유 디렉토리 설정 (`cluster` 1~4)
![[Pasted image 20251229122449.png]]
- NFS Storage 재시작
	- `sudo /etc/init.d/nfs-kernel-server restart`
	- `sudo systemctl restart portmap`
	- (확인) `sudo exportfs -v`
- 클러스터 전체에서 사용할 공유 스토리지 구성 완료
### SSH 생성 및 배포
- Cluster 설치를 위해 Inventory의 모든 서버들에 SSH Key 복사
- Master Node $\rightarrow$ Worker Node (`cluster2`, `cluster3`, `cluster4`) 접속 SSH Key
	- 노드 간 SSH 통신 가능
	- 자동화 및 관리 편의성 확보
![[Pasted image 20251229124226.png]]
1. Control Plane Node에서 RSA 공개 키 생성
	- `ssh-keygen -t rsa`
2. RSA 공개키 출력 및 복사
	- `cat ~/.ssh/id_rsa.pub`
3.  `~/.ssh/authorized_keys`에 `cluster1` public key 복사
	- Control Plane Node 및 Worker Node 모두 동일하게 진행 (`cluster` 1~4)
![[Pasted image 20251230104916.png]]
![[Pasted image 20251230104933.png]]
![[Pasted image 20251230104458.png]]
- `.ssh/id_rsa` key로 접속 가능
- 클러스터 설치 및 관리에 필요한 노드 간 신뢰 관계 구성