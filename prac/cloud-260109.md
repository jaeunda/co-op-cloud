---
Date: 2026-01-09
tags:
  - topic/cloud
  - type/practice
aliases:
  - cordon
  - taint
  - toleration
  - rolling-update
  - rollback
  - statefulset
  - job
  - cronjob
---
## 1. 노드 스케줄링 관리 (Cordon & Uncordon)
- `kubctl cordon` 특정 노드에 Pod가 할당되지 않도록 한다.
### 1-1. Deployment 배포
```sh
$ kubectl cordon jde-cluster2

# jde-cluster2에 Pod가 할당되지 않도록 한다.
$ kubectl get nodes
# jde-cluster2 STATUS: SchedulingDisabled
```
<img width="1435" height="283" alt="Pasted image 20260109104142" src="https://github.com/user-attachments/assets/016229b0-4514-446b-aea5-2d51a7001508" />

- 이 상태에서는 `jde-cluster2`에 새로운 Pod가 배포되지 않는다.
<img width="2432" height="307" alt="Pasted image 20260109104347" src="https://github.com/user-attachments/assets/9263d375-db5b-4912-a7ba-3ffbe64ad3fd" />

- Deployment를 배포했을 때 `cluster2`에는 배포되지 않는 것을 확인.
<img width="2464" height="226" alt="Pasted image 20260109104428" src="https://github.com/user-attachments/assets/1661d4c0-fd50-4f33-81c2-2b4b390df805" />

```sh
$ kubectl uncordon jde-cluster2
$ kubectl get nodes # jde-cluster2의 STATUS 확인
```
- `kubectl uncordon`을 통해 `jde-cluster2`의 `STATUS`를 다시 `Ready`로 복구한다.
<img width="2404" height="256" alt="Pasted image 20260109104516" src="https://github.com/user-attachments/assets/3f90a700-b5db-4634-976b-954087a4eaeb" />

- `jde-cluster2`에도 다시 Pod가 스케줄링됨을 확인할 수 있다.
<img width="2429" height="416" alt="Pasted image 20260109104738" src="https://github.com/user-attachments/assets/d711ceb5-4684-4ff6-b189-e50d2f86bf43" />

### 1-2. Deployment의 `replicas` 수정
- `replicas`를 4로 설정하여 `jde-deployment-node`를 배포한다.
- `kubectl cordon jde-cluster2`를 적용한 상태이므로 해당 노드에는 Pod가 스케줄링되지 않음.
<img width="2467" height="278" alt="Pasted image 20260109105155" src="https://github.com/user-attachments/assets/9c922e69-42ff-4571-acf0-3485a26c0673" />

- `jde-deployment-node`의 `replicas`를 6으로 변경한 후
- `jde-clsuter2` cordon을 해제한다.
```sh
# replicas 6으로 변경
$ kubectl edit deploy jde-deployment-node

# uncordon
$ kubectl uncordon jde-cluster2

# Pod 목록 조회
$ kubectl get pods -o wide
```
<img width="2465" height="318" alt="Pasted image 20260109105245" src="https://github.com/user-attachments/assets/fd8be508-8c67-4d92-94b8-3ac08636917a" />

- Pod의 개수가 6개로 변경되며
- `jde-cluster2`에도 Pod가 스케줄링된다.
<img width="2467" height="403" alt="Pasted image 20260109105305" src="https://github.com/user-attachments/assets/35366719-cf08-4c94-ba14-c15e2b80aeb9" />

## 2. 스케줄링 제어 (Taints & Tolerations)
- Taints: 특정 노드 (특히 Master Node)에 Pod가 배포되는 것을 제한
- Toleration: Taints를 무시하고 배포
### 2-1. Master Node의 Taints 조회
```sh
$ kubectl describe nodes jde-cluster1
# Taints 필드 확인
```
<img width="2470" height="1192" alt="Pasted image 20260109105408" src="https://github.com/user-attachments/assets/4d143c68-e756-4caf-b82f-99a099cc1de1" />

- `Taints: node-role.kubernetes.io/control-plane: NoSchedule`
	- 일반적으로 Control Plane에는 Pod가 배포되지 않는다.
### 2-2. `tolerations` 설정으로 Control Plane에 Pod 배포포
```sh
# deployment-node2.yaml

apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-toleration
  namespace: default
spec:
  selector:
    matchLabels:
      apps: apps
  replicas: 4
  template:
    metadata:
      labels:
        apps: apps
    spec:
      containers:
      - name: container
        image: nginx:latest
        ports:
        - containerPort: 80
          protocol: TCP
      tolerations:   # toleration: 강제로 Control Plane 노드에 파드 배포되도록
      - key: "node-role.kubernetes.io/control-plane"
        operator: "Equal"
        effect: "NoSchedule"
```
- `tolerations`
	- master node(control plane)에도 Pod 배포
	- taint 걸린 노드에도 배포
- `key`: 해당 cluster의 Taints 속성 값 그대로
<img width="1450" height="94" alt="Pasted image 20260109105836" src="https://github.com/user-attachments/assets/7a0ff5b9-6283-4b1e-a130-c280c861b5cd" />
<img width="2470" height="594" alt="Pasted image 20260109110040" src="https://github.com/user-attachments/assets/25188a25-4e9d-42c4-ae6e-81af224e9db4" />
<img width="2476" height="232" alt="Pasted image 20260109110734" src="https://github.com/user-attachments/assets/597b2ae5-6f85-422a-9c58-d504cfce4659" />
<img width="2442" height="563" alt="Pasted image 20260109110750" src="https://github.com/user-attachments/assets/23880c5f-92e7-445f-ba26-d652ff39c47a" />

- replicas 변경 (3)
	- kubectl scale --replicas 옵션
	- yaml 수정 후 apply
	- kubectl edit
## 3. 무중단 배포 및 롤백 (Rolling Update & Rollback)

<img width="2464" height="248" alt="Pasted image 20260109113242" src="https://github.com/user-attachments/assets/541fa11a-540c-4482-b33f-64d4a19f57a8" />

<img width="2456" height="233" alt="Pasted image 20260109113451" src="https://github.com/user-attachments/assets/f7d65ceb-9804-485c-ae55-b011295be662" />
<img width="2431" height="1230" alt="Pasted image 20260109113633" src="https://github.com/user-attachments/assets/4f4fd511-f6ab-4398-9f21-088919340b6c" />
<img width="1941" height="143" alt="Pasted image 20260109113647" src="https://github.com/user-attachments/assets/0b6be527-3b06-4296-bb91-9ed27738490e" />


<img width="1921" height="243" alt="Pasted image 20260109113753" src="https://github.com/user-attachments/assets/26a53b92-4460-45a6-b9cc-96727ab7b76c" />
<img width="2467" height="315" alt="Pasted image 20260109113954" src="https://github.com/user-attachments/assets/09253b7a-af5d-4dcb-9afa-4814a73a00e6" />

- 이미지 롤백
<img width="1899" height="187" alt="Pasted image 20260109114039" src="https://github.com/user-attachments/assets/5101b9ab-2061-4e3e-b509-4bb5a101758b" />

- 이력 확인
<img width="2485" height="518" alt="Pasted image 20260109114150" src="https://github.com/user-attachments/assets/52363642-ef60-4cde-9742-908c6e5dbe0b" />

<img width="2475" height="475" alt="Pasted image 20260109114356" src="https://github.com/user-attachments/assets/733fc72d-e203-4df5-a222-c1f8f619acab" />

## 4. 상태가 있는 애플리케이션 관리 (`StatefulSet`)
```sh
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: jde-sts
  namespace: jde-ns
spec:
  serviceName: "secloudit-service"
  replicas: 3
  updateStrategy:
    type: OnDelete
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.21
      volumes:
      - name: secloudit-volume
        emptyDir: {}

```
<img width="2476" height="1045" alt="Pasted image 20260109115047" src="https://github.com/user-attachments/assets/10694e9b-aebc-46a5-b64c-17e6968b90f2" />

0 1 2 배포


## 5. 일회성 작업 관리 (`Job`)
CLI로 Job
<img width="2480" height="211" alt="Pasted image 20260109115654" src="https://github.com/user-attachments/assets/41fe2584-02a6-4223-9bed-b707cb8cf0f4" />

- namespace 옵션 위치
<img width="2489" height="992" alt="Pasted image 20260109120822" src="https://github.com/user-attachments/assets/0654bfa1-2659-4019-9ea3-d1c5f6b5f7ae" />

<img width="2358" height="1082" alt="Pasted image 20260109115855" src="https://github.com/user-attachments/assets/f4e3e490-48a5-4dbe-a47e-df493491414e" />
<img width="1754" height="891" alt="Pasted image 20260109115907" src="https://github.com/user-attachments/assets/9d317fe1-6bc8-4b17-9bc9-39972cd59cdc" />

<img width="2494" height="861" alt="Pasted image 20260109120049" src="https://github.com/user-attachments/assets/65c71d46-410b-4c73-838a-1217bbca28c6" />
<img width="1346" height="85" alt="Pasted image 20260109120147" src="https://github.com/user-attachments/assets/e99ef50e-4555-4ca8-b0c7-57470dd958c0" />
<img width="1920" height="1146" alt="Pasted image 20260109120222" src="https://github.com/user-attachments/assets/4d58d10e-5d13-46a3-8fc0-ac7fb25db29c" />
<img width="1957" height="936" alt="Pasted image 20260109120248" src="https://github.com/user-attachments/assets/3ddac69c-ae06-4a02-9422-246ddb4c6a2f" />


## 6. 주기적 작업 관리 (`CronJob`)
- cronjob CLI로 생성
<img width="2496" height="200" alt="Pasted image 20260109120947" src="https://github.com/user-attachments/assets/f463ad54-64cf-4589-b768-e18cdcea67cc" />
<img width="1631" height="93" alt="Pasted image 20260109121020" src="https://github.com/user-attachments/assets/8c30f161-a2bb-4d37-8fae-53b9eda4a4b9" />

<img width="1880" height="1199" alt="Pasted image 20260109121059" src="https://github.com/user-attachments/assets/6e2e689a-4fda-4389-8e54-473cd16352df" />
<img width="1490" height="134" alt="Pasted image 20260109121119" src="https://github.com/user-attachments/assets/337e1213-7d2c-457d-8931-264c22abe8aa" />
<img width="1333" height="163" alt="Pasted image 20260109121228" src="https://github.com/user-attachments/assets/a516d354-2a10-4ae1-926e-9828fc47f899" />

<img width="2493" height="189" alt="Pasted image 20260109121756" src="https://github.com/user-attachments/assets/be9e4d1f-9956-4a06-938c-b35a8b9ab0a1" />

- cronjob 다음 job이 생성되는 시점
<img width="1462" height="259" alt="Pasted image 20260109121829" src="https://github.com/user-attachments/assets/277310c6-bfb3-4ca3-af75-a942de71df16" />
<img width="1498" height="205" alt="Pasted image 20260109121926" src="https://github.com/user-attachments/assets/1845d386-e0ca-4482-ac17-320304aaced7" />
<img width="1429" height="158" alt="Pasted image 20260109121940" src="https://github.com/user-attachments/assets/93d80403-bcaa-4a60-95fb-a74cd39e993d" />

<img width="2501" height="235" alt="Pasted image 20260109122256" src="https://github.com/user-attachments/assets/e68da5aa-ba8e-4baa-914d-d0ed8e6c8b22" />

```sh
apiVersion: batch/v1
kind: CronJob
metadata:
  name: jde-cronjob4
  namespace: jde-ns
spec:
  schedule: "*/1 * * * *"
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: Never
          containers:
          - name: secloudi-container
            image: kubetm/init
            command: ["sh", "-c", "echo 'start';sleep 20; echo 'end'"]
          terminationGracePeriodSeconds: 0
  successfulJobsHistoryLimit: 2
  failedJobsHistoryLimit: 1

```
<img width="2496" height="232" alt="Pasted image 20260109122429" src="https://github.com/user-attachments/assets/7babf1bd-4862-4e19-806f-919bda350ab8" />

![[Pasted image 20260109122440.png]]
![[Pasted image 20260109122516.png]]
![[Pasted image 20260109122711.png]]
![[Pasted image 20260109122738.png]]
- Completed 상태인 파드는 최대 2개
