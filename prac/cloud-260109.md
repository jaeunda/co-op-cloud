---
Date: 2026-01-09
tags:
  - topic/cloud
  - type/practice
aliases:
  - cordon
  - taint
  - toleration
  - rolling-update
  - rollback
  - statefulset
  - job
  - cronjob
---
## 1. 노드 스케줄링 관리 (Cordon & Uncordon)
- `kubctl cordon` 특정 노드에 Pod가 할당되지 않도록 한다.
### 1-1. Deployment 배포
```sh
$ kubectl cordon jde-cluster2

# jde-cluster2에 Pod가 할당되지 않도록 한다.
$ kubectl get nodes
# jde-cluster2 STATUS: SchedulingDisabled
```
![[Pasted image 20260109104142.png]]
- 이 상태에서는 `jde-cluster2`에 새로운 Pod가 배포되지 않는다.
![[Pasted image 20260109104347.png]]
- Deployment를 배포했을 때 `cluster2`에는 배포되지 않는 것을 확인.
![[Pasted image 20260109104428.png]]
```sh
$ kubectl uncordon jde-cluster2
$ kubectl get nodes # jde-cluster2의 STATUS 확인
```
- `kubectl uncordon`을 통해 `jde-cluster2`의 `STATUS`를 다시 `Ready`로 복구한다.
![[Pasted image 20260109104516.png]]
- `jde-cluster2`에도 다시 Pod가 스케줄링됨을 확인할 수 있다.
![[Pasted image 20260109104738.png]]
### 1-2. Deployment의 `replicas` 수정
- `replicas`를 4로 설정하여 `jde-deployment-node`를 배포한다.
- `kubectl cordon jde-cluster2`를 적용한 상태이므로 해당 노드에는 Pod가 스케줄링되지 않음.
![[Pasted image 20260109105155.png]]
- `jde-deployment-node`의 `replicas`를 6으로 변경한 후
- `jde-clsuter2` cordon을 해제한다.
```sh
# replicas 6으로 변경
$ kubectl edit deploy jde-deployment-node

# uncordon
$ kubectl uncordon jde-cluster2

# Pod 목록 조회
$ kubectl get pods -o wide
```
![[Pasted image 20260109105245.png]]
- Pod의 개수가 6개로 변경되며
- `jde-cluster2`에도 Pod가 스케줄링된다.
![[Pasted image 20260109105305.png]]
## 2. 스케줄링 제어 (Taints & Tolerations)
- Taints: 특정 노드 (특히 Master Node)에 Pod가 배포되는 것을 제한
- Toleration: Taints를 무시하고 배포
### 2-1. Master Node의 Taints 조회
```sh
$ kubectl describe nodes jde-cluster1
# Taints 필드 확인
```
![[Pasted image 20260109105408.png]]
- `Taints: node-role.kubernetes.io/control-plane: NoSchedule`
	- 일반적으로 Control Plane에는 Pod가 배포되지 않는다.
### 2-2. `tolerations` 설정으로 Control Plane에 Pod 배포포
```sh
# deployment-node2.yaml

apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-toleration
  namespace: default
spec:
  selector:
    matchLabels:
      apps: apps
  replicas: 4
  template:
    metadata:
      labels:
        apps: apps
    spec:
      containers:
      - name: container
        image: nginx:latest
        ports:
        - containerPort: 80
          protocol: TCP
      tolerations:   # toleration: 강제로 Control Plane 노드에 파드 배포되도록
      - key: "node-role.kubernetes.io/control-plane"
        operator: "Equal"
        effect: "NoSchedule"
```
- `tolerations`
	- master node(control plane)에도 Pod 배포
	- taint 걸린 노드에도 배포
- `key`: 해당 cluster의 Taints 속성 값 그대로
![[Pasted image 20260109105836.png]]
![[Pasted image 20260109110040.png]]
![[Pasted image 20260109110734.png]]
![[Pasted image 20260109110750.png]]
- replicas 변경 (3)
	- kubectl scale --replicas 옵션
	- yaml 수정 후 apply
	- kubectl edit
## 3. 무중단 배포 및 롤백 (Rolling Update & Rollback)

![[Pasted image 20260109113242.png]]

![[Pasted image 20260109113451.png]]
![[Pasted image 20260109113633.png]]
![[Pasted image 20260109113647.png]]


![[Pasted image 20260109113753.png]]
![[Pasted image 20260109113954.png]]
- 이미지 롤백
![[Pasted image 20260109114039.png]]
- 이력 확인
![[Pasted image 20260109114150.png]]

![[Pasted image 20260109114356.png]]

## 4. 상태가 있는 애플리케이션 관리 (`StatefulSet`)
```sh
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: jde-sts
  namespace: jde-ns
spec:
  serviceName: "secloudit-service"
  replicas: 3
  updateStrategy:
    type: OnDelete
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.21
      volumes:
      - name: secloudit-volume
        emptyDir: {}

```
![[Pasted image 20260109115047.png]]
0 1 2 배포


## 5. 일회성 작업 관리 (`Job`)
CLI로 Job
![[Pasted image 20260109115654.png]]
- namespace 옵션 위치
![[Pasted image 20260109120822.png]]

![[Pasted image 20260109115855.png]]
![[Pasted image 20260109115907.png]]

![[Pasted image 20260109120049.png]]
![[Pasted image 20260109120147.png]]
![[Pasted image 20260109120222.png]]
![[Pasted image 20260109120248.png]]


## 6. 주기적 작업 관리 (`CronJob`)
- cronjob CLI로 생성

![[Pasted image 20260109120947.png]]![[Pasted image 20260109121020.png]]
![[Pasted image 20260109121059.png]]
![[Pasted image 20260109121119.png]]
![[Pasted image 20260109121228.png]]

![[Pasted image 20260109121756.png]]
- cronjob 다음 job이 생성되는 시점
![[Pasted image 20260109121829.png]]
![[Pasted image 20260109121926.png]]
![[Pasted image 20260109121940.png]]

![[Pasted image 20260109122256.png]]

```sh
apiVersion: batch/v1
kind: CronJob
metadata:
  name: jde-cronjob4
  namespace: jde-ns
spec:
  schedule: "*/1 * * * *"
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: Never
          containers:
          - name: secloudi-container
            image: kubetm/init
            command: ["sh", "-c", "echo 'start';sleep 20; echo 'end'"]
          terminationGracePeriodSeconds: 0
  successfulJobsHistoryLimit: 2
  failedJobsHistoryLimit: 1

```
![[Pasted image 20260109122429.png]]

![[Pasted image 20260109122440.png]]
![[Pasted image 20260109122516.png]]
![[Pasted image 20260109122711.png]]
![[Pasted image 20260109122738.png]]
- Completed 상태인 파드는 최대 2개
