---
Date: 2026-01-05
tags:
  - type/practice
  - topic/cloud
aliases:
  - kubernetes-cli
  - namespace
  - service
  - deployment
  - pod
---
## Kubernetes CLI ì‹¤ìŠµ
### 1. Namespace ë°°í¬ ë° ì¡°íšŒ
```sh
# kpaas ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë°°í¬
$ kubectl create ns kpaas

# namespace ëª©ë¡
$ kubectl get namespace

# namespace ìƒì„¸ ì¡°íšŒ
$ kubectl describe ns kpaas
```
<img width="1741" height="634" alt="Pasted image 20260105104832" src="https://github.com/user-attachments/assets/3daae8bf-9a02-4e83-95fb-04571f90954c" />
<img width="1489" height="321" alt="Pasted image 20260105104957" src="https://github.com/user-attachments/assets/e12ae6d8-3924-49fb-afbc-8f1ff74289f5" />

###### yaml: namespace ë°°í¬
```yaml
# ns-kpaas.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: kpaas
  labels:
    name: kpaas
    environment: dev # Optional
```
```sh
$ kubectl apply -f ns-kpaas.yaml
```
<img width="626" height="435" alt="Pasted image 20260113152025" src="https://github.com/user-attachments/assets/afbe0ba4-2e34-4ee2-b212-4aa194bc590e" />

### 2. Pod ë°°í¬ ë° ì¡°íšŒ
```sh
# kpaas-nginx Pod ë°°í¬
# nginx:1.25 ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ kpaas namespaceì— ê²©ë¦¬í•˜ì—¬ ë°°í¬
$ kubectl run kpaas-nginx --image=nginx:1.25 -n kpaas

# Pod ëª©ë¡ ì¡°íšŒ 
$ kubectl get pod -n kpaas

# Pod ìƒì„¸ ì¡°íšŒ
$ kubectl describe pod kpaas-nginx -n kpaas
```
<img width="2306" height="1087" alt="Pasted image 20260105105308" src="https://github.com/user-attachments/assets/cc623375-aee4-4a59-a4ae-6fa89ed3a16c" />

###### yaml: Pod ë°°í¬
```yaml
# nginx-pod.yaml
apiVersion: v1
kind: Pod
metadata:
  name: kpaas-nginx       # Pod ì´ë¦„
  namespace: kpaas        # ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì§€ì • (-n kpaas)
spec:
  containers:
  - name: kpaas-nginx     # ì»¨í…Œì´ë„ˆ ì´ë¦„
    image: nginx:1.25     # ì´ë¯¸ì§€ íƒœê·¸ ì§€ì • (--image=nginx:1.25)
    ports:
    - containerPort: 80   # Nginx ê¸°ë³¸ í¬íŠ¸
```
```sh
$ kubectl apply -f nginx-pod.yaml
```
<img width="1673" height="454" alt="Pasted image 20260113152554" src="https://github.com/user-attachments/assets/c8d6524d-7088-442c-a931-a26f40e0b382" />

### 3. Service ë°°í¬
```sh
# Service ë°°í¬ (Pod ì—°ê²°)
$ kubectl expose pod kpaas-nginx --type=NodePort --port 80 --target-port=80 --name=kpaas-nginx -n kpaas

# Service ì¡°íšŒ
$ kubectl get service -n kpaas

# Service ìƒì„¸ ì¡°íšŒ
$ kubectl describe service kpaas-nginx -n kpaas
```
- `--port 80`: Service Port
	- í´ë¼ì´ì–¸íŠ¸, í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì˜ ë‹¤ë¥¸ Podê°€ Serviceì— ì ‘ê·¼í•  ë•Œ ì‚¬ìš©í•˜ëŠ” Port
- `--target-port=80`: Container Port
	- ì‹¤í–‰ ì¤‘ì¸ Pod ë‚´ë¶€ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ Port
	- Serviceê°€ ë°›ì€ ìš”ì²­ì„ ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ Forwarding í•´ì¤„ ë•Œ ì‚¬ìš©
	- **ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ì— ì •ì˜ëœ í¬íŠ¸ì™€ ì¼ì¹˜í•´ì•¼ í•¨.**
```
ì™¸ë¶€/í´ë¼ì´ì–¸íŠ¸  â”€â”€â–¶  [ Service ]  â”€â”€â–¶  [ Pod (Container) ]
                      â”‚                 â”‚
                  --port (80)       --target-port (80)
```
<img width="2132" height="777" alt="Pasted image 20260105105644" src="https://github.com/user-attachments/assets/27714e62-d3d1-4a5b-815a-6bd3bf94b55c" />

###### yaml: Service ë°°í¬
```yaml
# nginx-svc.yaml
apiVersion: v1
kind: Service
metadata:
  name: kpaas-nginx      # ì„œë¹„ìŠ¤ ì´ë¦„ (--name)
  namespace: kpaas       # ë„¤ì„ìŠ¤í˜ì´ìŠ¤ (-n)
spec:
  type: NodePort         # ì„œë¹„ìŠ¤ íƒ€ì… (--type=NodePort)
  selector:
    run: kpaas-nginx     # ì—°ê²°í•  Podì™€ ì¼ì¹˜í•´ì•¼ í•¨
  ports:
  - port: 80             # Service ì ‘ì† í¬íŠ¸ (--port)
    targetPort: 80       # Pod ë‚´ë¶€ ì»¨í…Œì´ë„ˆ í¬íŠ¸ (--target-port)
    protocol: TCP
```
- `kubectl run`ìœ¼ë¡œ ë§Œë“  PodëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `run` labelì„ ê°€ì§€ë¯€ë¡œ serviceë¥¼ ë¶™ì¼ ë•Œ ì°¸ê³ 
	- `selector: run: kpaas-nginx` (`run=kpaas-nginx`)
- ServiceëŠ” `selector`ì— í•´ë‹¹í•˜ëŠ” labelì„ ê°€ì§„ Podë¥¼ ê°€ë¦¬í‚´
```sh
$ kubectl apply -f nginx-pod.yaml
```
<img width="1279" height="531" alt="Pasted image 20260113152936" src="https://github.com/user-attachments/assets/fe236ba8-a102-4e52-98ff-4d518a67a58c" />

### 4. Deployment ë°°í¬
#### 4-1. Deployment ë°°í¬
```sh
# Deployment ë°°í¬
$ kubectl create deployment kpaas-nginx2 --image=nginx:1.26 --port=80 --replicas=2 -n kpaas

# Deployment ëª©ë¡ ì¡°íšŒ
$ kubectl get deploy -n kpaas

# Deployment ìƒì„¸ ì¡°íšŒ
$ kubectl describe pod kpaas-nginx2 -n kpaas
```
- `--port=80`: Container Port
	- ë‚´ë¶€ ì»¨í…Œì´ë„ˆê°€ ì‚¬ìš©í•˜ëŠ” Port
- `--replicas=2`
	- Pod 2ê°œ ìœ ì§€
	- ì„œë²„ í•˜ë‚˜ê°€ ì£½ì–´ë„ ë‚˜ë¨¸ì§€ í•˜ë‚˜ê°€ ì‚´ì•„ìˆì–´ì„œ ë¬´ì¤‘ë‹¨ ì„œë¹„ìŠ¤ ê°€ëŠ¥
	- `kpaas-nginx2` Pod 2ê°œ ìƒì„±
<img width="2345" height="945" alt="Pasted image 20260105110403" src="https://github.com/user-attachments/assets/587c4335-101e-4b0e-b9b9-600fdb7e8bac" />

###### yaml: Deployment ë°°í¬
```yaml
# nginx2-deploy.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kpaas-nginx2      # Deployment ì´ë¦„
  namespace: kpaas        # ë„¤ì„ìŠ¤í˜ì´ìŠ¤ (-n kpaas)
  labels:
    app: kpaas-nginx2     # Deployment ìì²´ì˜ label
spec:
  replicas: 2             # íŒŒë“œ ê°œìˆ˜ (--replicas=2)
  selector:
    matchLabels:
      app: kpaas-nginx2   # ê´€ë¦¬í•  Podì˜ label
  template:
    metadata:
      labels:
        app: kpaas-nginx2 # ìƒì„±ë  Podì— ë¶™ì„ label
    spec:
      containers:
      - name: nginx       # ì»¨í…Œì´ë„ˆ ì´ë¦„ 
        image: nginx:1.26 # ì´ë¯¸ì§€ íƒœê·¸ (--image=nginx:1.26)
        ports:
        - containerPort: 80 # í¬íŠ¸ ì„¤ì • (--port=80)
```
```sh
$ kubectl apply -f nginx2-deploy.yaml
$ kubectl describe pod kpaas-nginx2 -n kpaas
```
<img width="1258" height="472" alt="Pasted image 20260113153816" src="https://github.com/user-attachments/assets/62db2dc5-a9c4-4f75-8492-9e8d0a6d67b5" />

#### 4-2. Deploymentì— Service ì—°ê²°
```sh
# Service ë°°í¬ (Deployment ì—°ê²°)
$ kubectl expose deploy kpaas-nginx2 --type=NodePort --port=80 --target-port=80 --name=kpaas-nginx2 -n kpaas

# Service ëª©ë¡ ì¡°íšŒ
$ kubectl get service -n kpaas

# Service ìƒì„¸ ì¡°íšŒ
$ kubectl describe service kpaas-nginx -n kpaas
```
<img width="2245" height="829" alt="Pasted image 20260105110835" src="https://github.com/user-attachments/assets/f5494325-4480-4f55-9f17-1ec40e3fdf71" />

###### yaml:
```yaml
# nginx2-svc.yaml
apiVersion: v1
kind: Service
metadata:
  name: kpaas-nginx2     # ì„œë¹„ìŠ¤ ì´ë¦„ (--name)
  namespace: kpaas       # ë„¤ì„ìŠ¤í˜ì´ìŠ¤ (-n)
spec:
  type: NodePort         # ì„œë¹„ìŠ¤ íƒ€ì… (--type=NodePort)
  selector:
    app: kpaas-nginx2    # Deploymentì˜ labelê³¼ ì¼ì¹˜í•´ì•¼ í•¨
  ports:
  - port: 80             # Service Port (--port)
    targetPort: 80       # Container Port (--target-port)
    protocol: TCP
```
- `kubectl create deployment`ë¡œ ë§Œë“  deploymentëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `app` labelì„ ê°€ì§
	- ë”°ë¼ì„œ Serviceê°€ Deploymentê°€ ê´€ë¦¬í•˜ëŠ” Podë¥¼ ì°¾ìœ¼ë ¤ë©´ `app` labelì„ ê°€ë¦¬ì¼œì•¼ í•¨
	- `selector: app: kpaas-nginx2`
```sh
$ kubectl apply -f nginx2-svc.yaml
$ kubectl describe svc kpaas-nginx2 -n kpaas
```
<img width="928" height="381" alt="Pasted image 20260113154037" src="https://github.com/user-attachments/assets/cacc84f8-17a3-4cb5-a8b2-0823b5493a3f" />

#### 4-3. Deployment ì„¤ì • ë³€ê²½
```sh
# Deploymentì˜ replicas ì„¤ì • ë³€ê²½
$ kubectl edit deploy kpaas-nginx2 -n kpaas

# replicas 2ì—ì„œ 4ë¡œ ë³€ê²½ í›„ 
# Pod ëª©ë¡ ì¡°íšŒ
$ kubectl get pod -n kpaas
# Pod ê°œìˆ˜ 4ê°œë¡œ ëŠ˜ì–´ë‚¨
```
<img width="1906" height="488" alt="Pasted image 20260105111306" src="https://github.com/user-attachments/assets/9c0011bc-18f2-48fa-95f8-819f0d6da703" />
<img width="1497" height="624" alt="Pasted image 20260105111521" src="https://github.com/user-attachments/assets/08aed928-9853-4d48-bf0b-954ec29798ce" />

### 5. ì‹¤ìŠµ í›„ ë¦¬ì†ŒìŠ¤ ì´ˆê¸°í™”
```sh
$ kubectl delete -f .
pod "kpaas-nginx" deleted
service "kpaas-nginx" deleted
deployment.apps "kpaas-nginx2" deleted
service "kpaas-nginx2" deleted
namespace "kpaas" deleted
```
<img width="706" height="92" alt="Pasted image 20260113154642" src="https://github.com/user-attachments/assets/4c42b85a-1525-4b0e-b846-421f2148ed9d" />

## Container Platform ì„œë¹„ìŠ¤ í™œìš© MSA application êµ¬ì¶•
- MSA Sample ê°€ì´ë“œ ì£¼ì†Œ: https://github.com/K-PaaS/msa-sample
<img width="2081" height="961" alt="Pasted image 20260112163651" src="https://github.com/user-attachments/assets/f206b177-6985-41d2-a93c-7ca482efefd2" />

#### Architecture
<img width="2375" height="1140" alt="Pasted image 20260112163750" src="https://github.com/user-attachments/assets/c869ef9e-5cdd-43b8-9308-0ffc9e3634bf" />

##### 1. msa-sample-ui
- í™”ë©´ ì„œë¹„ìŠ¤ë¥¼ ë‹´ë‹¹í•˜ëŠ” API
##### 2. msa-sample-gateway
- API ì„œë²„ ì•ë‹¨ì—ì„œ ì—¬ëŸ¬ API ì„œë²„ë“¤ì˜ Endpointë¥¼ ë‹¨ì¼í™”í•˜ì—¬ 
- ë¼ìš°íŒ…, ë¡œë“œë°¸ëŸ°ì‹± ë“±ì˜ ì—­í• ì„ í•˜ëŠ” API
##### 3. msa-sample-api & msa-sample-sd-api
- ê°ê° ë©”ì¸ í™”ë©´/side í™”ë©´ ì •ë³´ì— ëŒ€í•œ ì„œë¹„ìŠ¤ë¥¼ ë‹´ë‹¹í•˜ëŠ” api
### 0. unseal `openbao`
```sh
$ kubectl get pod -n openbao
# ì´ˆê¸°: openbao READY 0/1
```
<img width="1503" height="173" alt="Pasted image 20260105103801" src="https://github.com/user-attachments/assets/299aa327-8fe3-45ad-b314-5596d3257ecb" />

```sh
#1. ë°°í¬ëœ Vaultì˜ Unseal Key í™•ì¸
$ cat ~/workspace/container-platform/cp-portal-deployment/secmg/unseal-key

#2. 'openbao-0' podì— ì ‘ì† 
$ kubectl exec -it openbao-0 -n openbao -- sh

#3. vault unseal ìƒíƒœë¡œ ë³€ê²½í•˜ê¸°
##3-1. unseal ì²«ë²ˆì§¸ í‚¤ ì…ë ¥
/ $ vault operator unseal
Unseal Key (will be hidden):  ğŸ’ # ì²«ë²ˆì§¸ í‚¤ ì…ë ¥

##3-2. unseal ë‘ë²ˆì§¸ í‚¤ ì…ë ¥
/ $ vault operator unseal
Unseal Key (will be hidden):  ğŸ’ # ë‘ë²ˆì§¸ í‚¤ ì…ë ¥

/ $ exit

#4. ì •ìƒ ì‘ë™ í™•ì¸
$ kubectl get pod -n openbao
NAME                                      READY   STATUS    RESTARTS   AGE
openbao-0                                 1/1     Running   5          6d18h
openbao-agent-injector-6567764cc9-7zx8l   1/1     Running   3          4d20h
```
<img width="2018" height="1278" alt="Pasted image 20260105112402" src="https://github.com/user-attachments/assets/ecffccaa-fcbc-42b3-914f-321b5f6da548" />

###### `openbao`ê°€ ì‘ë™í•˜ì§€ ì•Šìœ¼ë©´ `503` Error
- `https://portal.133.186.xxx.xxx.nip.io/`
<img width="895" height="356" alt="Pasted image 20260105104624" src="https://github.com/user-attachments/assets/59cb9cdc-4138-4cf9-9d6d-ea0d3ed6c49f" />
<img width="917" height="172" alt="Pasted image 20260105110428" src="https://github.com/user-attachments/assets/db465d7c-9976-4eab-816e-40fd7ce2ec99" />

### 1. í™˜ê²½ë³€ìˆ˜ ë°°í¬
#### 1-1. í¬í„¸ ì‚¬ìš©ì ë¡œê·¸ì¸
```sh
$ kubectl get ingress -A
# portal.133.186.xxx.xxx.nip.io ì ‘ì†

# Username: admin
# Password: 
```
#### 1-2. `Configmap` ìƒì„±
- [ConfigMap YAML ë§í¬](https://github.com/K-PaaS/msa-sample/blob/master/resource/configmap.yml)
- `{K8S_MASTER_NODE_IP}`ì— Control Plane Nodeì˜ Public IP ì£¼ì†Œ ì…ë ¥
```sh
apiVersion: v1
kind: ConfigMap
metadata:
  name: kpaas-msa-configmap
  namespace: default
data:
  MSA_API_URL: http://133.186.xxx.xxx:30010
  MSA_SD_API_URL: http://133.186.xxx.xxx:30014
  MSA_UI_URL: http://133.186.xxx.xxx:30011
  MSA_GATEWAY_URL: http://133.186.xxx.xxx:30012
```
<img width="1061" height="694" alt="Pasted image 20260105114052" src="https://github.com/user-attachments/assets/48bfc62c-3430-4402-ba15-8dfb1fc0fcfb" />

### 2. Repository ìƒì„±
#### 2-1. K-PaaS SCM í¬í„¸ì— ë¹ˆ ì €ì¥ì†Œ ìƒì„±
<img width="1045" height="802" alt="Pasted image 20260105114837" src="https://github.com/user-attachments/assets/a44fb0a3-1168-41cf-b25f-0ea4918862b8" />

#### 2-2. `git clone` 
- `cluster1`ì—ì„œ Github ì†ŒìŠ¤ì½”ë“œ ë‹¤ìš´ë¡œë“œ
	- `--mirror`: Commit history, branch, tag ë“± ê´€ë¦¬ ì´ë ¥ë§Œ ë‹´ê³  ìˆëŠ” í˜•íƒœë¡œ ê°€ì ¸ì˜´.
	- ì €ì¥ì†Œ ìì²´ë¥¼ ì´ë™ì‹œí‚¤ê¸° ìœ„í•¨
<img width="1758" height="1092" alt="Pasted image 20260105114612" src="https://github.com/user-attachments/assets/b3b12096-3385-446d-9539-e3368ebe38c8" />

#### 2-3. SCM ì„œë²„ë¡œ ì „ì†¡
- ë‹¤ìš´ë¡œë“œí•œ ë””ë ‰í† ë¦¬ ë‚´ë¶€ë¡œ ì´ë™ í›„
- ë‚´ë¶€ SCM ì„œë²„ë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•œë‹¤.
	- `git push --mirror [SCM_URL]`
	- ë¡œì»¬ì— ê°€ì§€ê³  ìˆë˜ ëª¨ë“  Git ì´ë ¥ì„ ë‚´ë¶€ ì„œë²„ì˜ ë¹ˆ ì €ì¥ì†Œë¡œ Push
<img width="2264" height="678" alt="Pasted image 20260105115031" src="https://github.com/user-attachments/assets/7660b7af-4d07-4401-8c5d-664d93ec263f" />
<img width="978" height="704" alt="Pasted image 20260105115048" src="https://github.com/user-attachments/assets/0816937a-4715-4b09-ad34-db909f75715d" />
<img width="2299" height="522" alt="Pasted image 20260105115224" src="https://github.com/user-attachments/assets/27eb7d5d-a167-438c-a3e4-42fa7fbbd2b1" />
<img width="959" height="775" alt="Pasted image 20260105115235" src="https://github.com/user-attachments/assets/49216bfd-efed-490f-8472-d8220bcba364" />
<img width="2220" height="499" alt="Pasted image 20260105115330" src="https://github.com/user-attachments/assets/0e2e29cf-3fdc-4878-b574-bd66e6caf509" />
<img width="847" height="775" alt="Pasted image 20260105115356" src="https://github.com/user-attachments/assets/0299f06a-bb85-4384-8f8e-d6e93133972e" />
<img width="2331" height="519" alt="Pasted image 20260105115442" src="https://github.com/user-attachments/assets/12ec862f-812b-479d-a8f2-e1039d256778" />
<img width="933" height="769" alt="Pasted image 20260105115503" src="https://github.com/user-attachments/assets/d9525e1a-145e-43d7-931b-1d6d4903af14" />

### 3. íŒŒì´í”„ë¼ì¸ ì„¤ì •
#### 3-1. Kube Config ì¡°íšŒ ë° ë“±ë¡
```sh
$ ls .kube
$ cat .kube/kubeconfig # config ì¡°íšŒ
```

```sh
# kubeconfig

apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: 
	    ...
    server: https://133.186.xxx.xxx:6443
  name: cluster-host
contexts:
- context:
    cluster: cluster-host
    user: cluster-host-admin
  name: cluster-host
current-context: cluster-host
kind: Config
preferences: {}
users:
- name: cluster-host-admin
  user:
    client-certificate-data: 
	    ...
    client-key-data: 
	    ...
```
- íŒŒì´í”„ë¼ì¸ ê´€ë¦¬ - Kubernetes ì •ë³´ ê´€ë¦¬ - Kube Config ë“±ë¡
<img width="755" height="296" alt="Pasted image 20260105121303" src="https://github.com/user-attachments/assets/534d1421-5544-46f2-87ff-e021df1117ac" />

### 4. íŒŒì´í”„ë¼ì¸ ìƒì„±
<img width="919" height="176" alt="Pasted image 20260105121410" src="https://github.com/user-attachments/assets/4cb10e0c-a0c1-41e9-97ed-5a88b7cee6a1" />
<img width="853" height="801" alt="Pasted image 20260105121649" src="https://github.com/user-attachments/assets/0c8f0845-95f6-4e53-947e-9a3c067d4014" />
- `openjdk` $\rightarrow$ `amazoncorretto` ì´ë¯¸ì§€ ë³€ê²½
<img width="919" height="642" alt="Pasted image 20260105121808" src="https://github.com/user-attachments/assets/19a54980-2d3d-4ffc-b6d9-8a62190754e5" />
<img width="1006" height="598" alt="Pasted image 20260105122018" src="https://github.com/user-attachments/assets/d637726c-9cfd-412c-80b0-0993b9344bc8" />
<img width="980" height="607" alt="Pasted image 20260105122158" src="https://github.com/user-attachments/assets/94cad45e-d2ed-4df2-9236-f17750bd4016" />
<img width="1051" height="406" alt="Pasted image 20260105122249" src="https://github.com/user-attachments/assets/8ba615ac-f761-42d0-833b-3f453ef1d7f3" />

<img width="1047" height="818" alt="Pasted image 20260105124655" src="https://github.com/user-attachments/assets/de2121f6-f6ba-4246-893d-7fac13e792e8" />
<img width="1072" height="915" alt="Pasted image 20260105124755" src="https://github.com/user-attachments/assets/69fa233b-2f24-4b34-8313-1bc3d2e4118b" />
