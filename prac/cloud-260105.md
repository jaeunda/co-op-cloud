---
Date: 2026-01-05
tags:
  - type/practice
  - topic/cloud
aliases:
  - kubernetes-cli
  - namespace
  - service
  - deployment
  - pod
---
## Kubernetes CLI ì‹¤ìŠµ
### 1. Namespace ë°°í¬ ë° ì¡°íšŒ
```sh
# kpaas ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë°°í¬
$ kubectl create ns kpaas

# namespace ëª©ë¡
$ kubectl get namespace

# namespace ìƒì„¸ ì¡°íšŒ
$ kubectl describe ns kpaas
```
![[Pasted image 20260105104832.png]]
![[Pasted image 20260105104957.png]]
###### yaml: namespace ë°°í¬
```yaml
# ns-kpaas.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: kpaas
  labels:
    name: kpaas
    environment: dev # Optional
```
```sh
$ kubectl apply -f ns-kpaas.yaml
```
![[Pasted image 20260113152025.png]]
### 2. Pod ë°°í¬ ë° ì¡°íšŒ
```sh
# kpaas-nginx Pod ë°°í¬
# nginx:1.25 ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ kpaas namespaceì— ê²©ë¦¬í•˜ì—¬ ë°°í¬
$ kubectl run kpaas-nginx --image=nginx:1.25 -n kpaas

# Pod ëª©ë¡ ì¡°íšŒ 
$ kubectl get pod -n kpaas

# Pod ìƒì„¸ ì¡°íšŒ
$ kubectl describe pod kpaas-nginx -n kpaas
```
![[Pasted image 20260105105308.png]]
###### yaml: Pod ë°°í¬
```yaml
# nginx-pod.yaml
apiVersion: v1
kind: Pod
metadata:
  name: kpaas-nginx       # Pod ì´ë¦„
  namespace: kpaas        # ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì§€ì • (-n kpaas)
spec:
  containers:
  - name: kpaas-nginx     # ì»¨í…Œì´ë„ˆ ì´ë¦„
    image: nginx:1.25     # ì´ë¯¸ì§€ íƒœê·¸ ì§€ì • (--image=nginx:1.25)
    ports:
    - containerPort: 80   # Nginx ê¸°ë³¸ í¬íŠ¸
```
```sh
$ kubectl apply -f nginx-pod.yaml
```
![[Pasted image 20260113152554.png]]
### 3. Service ë°°í¬
```sh
# Service ë°°í¬ (Pod ì—°ê²°)
$ kubectl expose pod kpaas-nginx --type=NodePort --port 80 --target-port=80 --name=kpaas-nginx -n kpaas

# Service ì¡°íšŒ
$ kubectl get service -n kpaas

# Service ìƒì„¸ ì¡°íšŒ
$ kubectl describe service kpaas-nginx -n kpaas
```
- `--port 80`: Service Port
	- í´ë¼ì´ì–¸íŠ¸, í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì˜ ë‹¤ë¥¸ Podê°€ Serviceì— ì ‘ê·¼í•  ë•Œ ì‚¬ìš©í•˜ëŠ” Port
- `--target-port=80`: Container Port
	- ì‹¤í–‰ ì¤‘ì¸ Pod ë‚´ë¶€ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ Port
	- Serviceê°€ ë°›ì€ ìš”ì²­ì„ ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ Forwarding í•´ì¤„ ë•Œ ì‚¬ìš©
	- **ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ì— ì •ì˜ëœ í¬íŠ¸ì™€ ì¼ì¹˜í•´ì•¼ í•¨.**
```
ì™¸ë¶€/í´ë¼ì´ì–¸íŠ¸  â”€â”€â–¶  [ Service ]  â”€â”€â–¶  [ Pod (Container) ]
                      â”‚                 â”‚
                  --port (80)       --target-port (80)
```
![[Pasted image 20260105105644.png]]
###### yaml: Service ë°°í¬
```yaml
# nginx-svc.yaml
apiVersion: v1
kind: Service
metadata:
  name: kpaas-nginx      # ì„œë¹„ìŠ¤ ì´ë¦„ (--name)
  namespace: kpaas       # ë„¤ì„ìŠ¤í˜ì´ìŠ¤ (-n)
spec:
  type: NodePort         # ì„œë¹„ìŠ¤ íƒ€ì… (--type=NodePort)
  selector:
    run: kpaas-nginx     # ì—°ê²°í•  Podì™€ ì¼ì¹˜í•´ì•¼ í•¨
  ports:
  - port: 80             # Service ì ‘ì† í¬íŠ¸ (--port)
    targetPort: 80       # Pod ë‚´ë¶€ ì»¨í…Œì´ë„ˆ í¬íŠ¸ (--target-port)
    protocol: TCP
```
- `kubectl run`ìœ¼ë¡œ ë§Œë“  PodëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `run` labelì„ ê°€ì§€ë¯€ë¡œ serviceë¥¼ ë¶™ì¼ ë•Œ ì°¸ê³ 
	- `selector: run: kpaas-nginx` (`run=kpaas-nginx`)
- ServiceëŠ” `selector`ì— í•´ë‹¹í•˜ëŠ” labelì„ ê°€ì§„ Podë¥¼ ê°€ë¦¬í‚´
```sh
$ kubectl apply -f nginx-pod.yaml
```
![[Pasted image 20260113152936.png]]
### 4. Deployment ë°°í¬
#### 4-1. Deployment ë°°í¬
```sh
# Deployment ë°°í¬
$ kubectl create deployment kpaas-nginx2 --image=nginx:1.26 --port=80 --replicas=2 -n kpaas

# Deployment ëª©ë¡ ì¡°íšŒ
$ kubectl get deploy -n kpaas

# Deployment ìƒì„¸ ì¡°íšŒ
$ kubectl describe pod kpaas-nginx2 -n kpaas
```
- `--port=80`: Container Port
	- ë‚´ë¶€ ì»¨í…Œì´ë„ˆê°€ ì‚¬ìš©í•˜ëŠ” Port
- `--replicas=2`
	- Pod 2ê°œ ìœ ì§€
	- ì„œë²„ í•˜ë‚˜ê°€ ì£½ì–´ë„ ë‚˜ë¨¸ì§€ í•˜ë‚˜ê°€ ì‚´ì•„ìˆì–´ì„œ ë¬´ì¤‘ë‹¨ ì„œë¹„ìŠ¤ ê°€ëŠ¥
	- `kpaas-nginx2` Pod 2ê°œ ìƒì„±
![[Pasted image 20260105110403.png]]
###### yaml: Deployment ë°°í¬
```yaml
# nginx2-deploy.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kpaas-nginx2      # Deployment ì´ë¦„
  namespace: kpaas        # ë„¤ì„ìŠ¤í˜ì´ìŠ¤ (-n kpaas)
  labels:
    app: kpaas-nginx2     # Deployment ìì²´ì˜ label
spec:
  replicas: 2             # íŒŒë“œ ê°œìˆ˜ (--replicas=2)
  selector:
    matchLabels:
      app: kpaas-nginx2   # ê´€ë¦¬í•  Podì˜ label
  template:
    metadata:
      labels:
        app: kpaas-nginx2 # ìƒì„±ë  Podì— ë¶™ì„ label
    spec:
      containers:
      - name: nginx       # ì»¨í…Œì´ë„ˆ ì´ë¦„ 
        image: nginx:1.26 # ì´ë¯¸ì§€ íƒœê·¸ (--image=nginx:1.26)
        ports:
        - containerPort: 80 # í¬íŠ¸ ì„¤ì • (--port=80)
```
```sh
$ kubectl apply -f nginx2-deploy.yaml
$ kubectl describe pod kpaas-nginx2 -n kpaas
```
![[Pasted image 20260113153816.png]]
#### 4-2. Deploymentì— Service ì—°ê²°
```sh
# Service ë°°í¬ (Deployment ì—°ê²°)
$ kubectl expose deploy kpaas-nginx2 --type=NodePort --port=80 --target-port=80 --name=kpaas-nginx2 -n kpaas

# Service ëª©ë¡ ì¡°íšŒ
$ kubectl get service -n kpaas

# Service ìƒì„¸ ì¡°íšŒ
$ kubectl describe service kpaas-nginx -n kpaas
```
![[Pasted image 20260105110835.png]]
###### yaml:
```yaml
# nginx2-svc.yaml
apiVersion: v1
kind: Service
metadata:
  name: kpaas-nginx2     # ì„œë¹„ìŠ¤ ì´ë¦„ (--name)
  namespace: kpaas       # ë„¤ì„ìŠ¤í˜ì´ìŠ¤ (-n)
spec:
  type: NodePort         # ì„œë¹„ìŠ¤ íƒ€ì… (--type=NodePort)
  selector:
    app: kpaas-nginx2    # Deploymentì˜ labelê³¼ ì¼ì¹˜í•´ì•¼ í•¨
  ports:
  - port: 80             # Service Port (--port)
    targetPort: 80       # Container Port (--target-port)
    protocol: TCP
```
- `kubectl create deployment`ë¡œ ë§Œë“  deploymentëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `app` labelì„ ê°€ì§
	- ë”°ë¼ì„œ Serviceê°€ Deploymentê°€ ê´€ë¦¬í•˜ëŠ” Podë¥¼ ì°¾ìœ¼ë ¤ë©´ `app` labelì„ ê°€ë¦¬ì¼œì•¼ í•¨
	- `selector: app: kpaas-nginx2`
```sh
$ kubectl apply -f nginx2-svc.yaml
$ kubectl describe svc kpaas-nginx2 -n kpaas
```
![[Pasted image 20260113154037.png]]
#### 4-3. Deployment ì„¤ì • ë³€ê²½
```sh
# Deploymentì˜ replicas ì„¤ì • ë³€ê²½
$ kubectl edit deploy kpaas-nginx2 -n kpaas

# replicas 2ì—ì„œ 4ë¡œ ë³€ê²½ í›„ 
# Pod ëª©ë¡ ì¡°íšŒ
$ kubectl get pod -n kpaas
# Pod ê°œìˆ˜ 4ê°œë¡œ ëŠ˜ì–´ë‚¨
```
![[Pasted image 20260105111306.png]]
![[Pasted image 20260105111521.png]]
### 5. ì‹¤ìŠµ í›„ ë¦¬ì†ŒìŠ¤ ì´ˆê¸°í™”
```sh
$ kubectl delete -f .
pod "kpaas-nginx" deleted
service "kpaas-nginx" deleted
deployment.apps "kpaas-nginx2" deleted
service "kpaas-nginx2" deleted
namespace "kpaas" deleted
```
![[Pasted image 20260113154642.png]]
## Container Platform ì„œë¹„ìŠ¤ í™œìš© MSA application êµ¬ì¶•
- MSA Sample ê°€ì´ë“œ ì£¼ì†Œ: https://github.com/K-PaaS/msa-sample
![[Pasted image 20260112163651.png]]
#### Architecture
![[Pasted image 20260112163750.png]]
##### 1. msa-sample-ui
- í™”ë©´ ì„œë¹„ìŠ¤ë¥¼ ë‹´ë‹¹í•˜ëŠ” API
##### 2. msa-sample-gateway
- API ì„œë²„ ì•ë‹¨ì—ì„œ ì—¬ëŸ¬ API ì„œë²„ë“¤ì˜ Endpointë¥¼ ë‹¨ì¼í™”í•˜ì—¬ 
- ë¼ìš°íŒ…, ë¡œë“œë°¸ëŸ°ì‹± ë“±ì˜ ì—­í• ì„ í•˜ëŠ” API
##### 3. msa-sample-api & msa-sample-sd-api
- ê°ê° ë©”ì¸ í™”ë©´/side í™”ë©´ ì •ë³´ì— ëŒ€í•œ ì„œë¹„ìŠ¤ë¥¼ ë‹´ë‹¹í•˜ëŠ” api
### 0. unseal `openbao`
```sh
$ kubectl get pod -n openbao
# ì´ˆê¸°: openbao READY 0/1
```
![[Pasted image 20260105103801.png]]
```sh
#1. ë°°í¬ëœ Vaultì˜ Unseal Key í™•ì¸
$ cat ~/workspace/container-platform/cp-portal-deployment/secmg/unseal-key

#2. 'openbao-0' podì— ì ‘ì† 
$ kubectl exec -it openbao-0 -n openbao -- sh

#3. vault unseal ìƒíƒœë¡œ ë³€ê²½í•˜ê¸°
##3-1. unseal ì²«ë²ˆì§¸ í‚¤ ì…ë ¥
/ $ vault operator unseal
Unseal Key (will be hidden):  ğŸ’ # ì²«ë²ˆì§¸ í‚¤ ì…ë ¥

##3-2. unseal ë‘ë²ˆì§¸ í‚¤ ì…ë ¥
/ $ vault operator unseal
Unseal Key (will be hidden):  ğŸ’ # ë‘ë²ˆì§¸ í‚¤ ì…ë ¥

/ $ exit

#4. ì •ìƒ ì‘ë™ í™•ì¸
$ kubectl get pod -n openbao
NAME                                      READY   STATUS    RESTARTS   AGE
openbao-0                                 1/1     Running   5          6d18h
openbao-agent-injector-6567764cc9-7zx8l   1/1     Running   3          4d20h
```
![[Pasted image 20260105112402.png]]
###### `openbao`ê°€ ì‘ë™í•˜ì§€ ì•Šìœ¼ë©´ `503` Error
- `https://portal.133.186.xxx.xxx.nip.io/`
<img src="Pasted image 20260105104624.png" style="display: block; margin: auto; width: 80%">
<img src="Pasted image 20260105110428.png" width="100%">

### 1. í™˜ê²½ë³€ìˆ˜ ë°°í¬
#### 1-1. í¬í„¸ ì‚¬ìš©ì ë¡œê·¸ì¸
```sh
$ kubectl get ingress -A
# portal.133.186.xxx.xxx.nip.io ì ‘ì†

# Username: admin
# Password: 
```
#### 1-2. `Configmap` ìƒì„±
- [ConfigMap YAML ë§í¬](https://github.com/K-PaaS/msa-sample/blob/master/resource/configmap.yml)
- `{K8S_MASTER_NODE_IP}`ì— Control Plane Nodeì˜ Public IP ì£¼ì†Œ ì…ë ¥
```sh
apiVersion: v1
kind: ConfigMap
metadata:
  name: kpaas-msa-configmap
  namespace: default
data:
  MSA_API_URL: http://133.186.xxx.xxx:30010
  MSA_SD_API_URL: http://133.186.xxx.xxx:30014
  MSA_UI_URL: http://133.186.xxx.xxx:30011
  MSA_GATEWAY_URL: http://133.186.xxx.xxx:30012
```
![[Pasted image 20260105114052.png]]
### 2. Repository ìƒì„±
#### 2-1. K-PaaS SCM í¬í„¸ì— ë¹ˆ ì €ì¥ì†Œ ìƒì„±
![[Pasted image 20260105114837.png]]
#### 2-2. `git clone` 
- `cluster1`ì—ì„œ Github ì†ŒìŠ¤ì½”ë“œ ë‹¤ìš´ë¡œë“œ
	- `--mirror`: Commit history, branch, tag ë“± ê´€ë¦¬ ì´ë ¥ë§Œ ë‹´ê³  ìˆëŠ” í˜•íƒœë¡œ ê°€ì ¸ì˜´.
	- ì €ì¥ì†Œ ìì²´ë¥¼ ì´ë™ì‹œí‚¤ê¸° ìœ„í•¨
![[Pasted image 20260105114612.png]]
#### 2-3. SCM ì„œë²„ë¡œ ì „ì†¡
- ë‹¤ìš´ë¡œë“œí•œ ë””ë ‰í† ë¦¬ ë‚´ë¶€ë¡œ ì´ë™ í›„
- ë‚´ë¶€ SCM ì„œë²„ë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•œë‹¤.
	- `git push --mirror [SCM_URL]`
	- ë¡œì»¬ì— ê°€ì§€ê³  ìˆë˜ ëª¨ë“  Git ì´ë ¥ì„ ë‚´ë¶€ ì„œë²„ì˜ ë¹ˆ ì €ì¥ì†Œë¡œ Push
![[Pasted image 20260105115031.png]]
![[Pasted image 20260105115048.png]]
![[Pasted image 20260105115224.png]]
![[Pasted image 20260105115235.png]]
![[Pasted image 20260105115330.png]]
![[Pasted image 20260105115356.png]]
![[Pasted image 20260105115442.png]]
![[Pasted image 20260105115503.png]]
### 3. íŒŒì´í”„ë¼ì¸ ì„¤ì •
#### 3-1. Kube Config ì¡°íšŒ ë° ë“±ë¡
```sh
$ ls .kube
$ cat .kube/kubeconfig # config ì¡°íšŒ
```

```sh
# kubeconfig

apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: 
	    ...
    server: https://133.186.xxx.xxx:6443
  name: cluster-host
contexts:
- context:
    cluster: cluster-host
    user: cluster-host-admin
  name: cluster-host
current-context: cluster-host
kind: Config
preferences: {}
users:
- name: cluster-host-admin
  user:
    client-certificate-data: 
	    ...
    client-key-data: 
	    ...
```
- íŒŒì´í”„ë¼ì¸ ê´€ë¦¬ - Kubernetes ì •ë³´ ê´€ë¦¬ - Kube Config ë“±ë¡
<img src="Pasted image 20260105121303.png" width="50%">
### 4. íŒŒì´í”„ë¼ì¸ ìƒì„±
![[Pasted image 20260105121410.png]]
![[Pasted image 20260105121649.png]]
- `openjdk` $\rightarrow$ `amazoncorretto` ì´ë¯¸ì§€ ë³€ê²½
![[Pasted image 20260105121808.png]]
![[Pasted image 20260105122018.png]]
![[Pasted image 20260105122158.png]]
![[Pasted image 20260105122249.png]]

![[Pasted image 20260105124655.png]]
![[Pasted image 20260105124755.png]]
